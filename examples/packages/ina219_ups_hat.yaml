ina219_ups_hat:
  sensor:
    - platform: ina219_ups_hat
      name: Hassio UPS SoC
      unique_id: hassio_ups
      scan_interval: 30
      batteries_count: 3
      max_soc: 91
      battery_capacity: 9000
      sma_samples: 5

    - platform: filter
      name: "Hassio UPS SMA Load Voltage"
      entity_id: sensor.hassio_ups_raw_load_voltage
      unique_id: waveshare_ups_hat_sma_load_voltage
      filters:
        - filter: time_simple_moving_average
          window_size: "00:01"
          precision: 2

  template:
    - sensor:
        - name: "Hassio UPS Raw PSU Voltage"
          state: "{{ state_attr('sensor.hassio_ups', 'psu_voltage') | round(2) }}"
          unit_of_measurement: "V"
          state_class: measurement
        - name: "Hassio UPS Raw Current"
          state: "{{ state_attr('sensor.hassio_ups', 'current') * 1000 | round(1) }}"
          unit_of_measurement: "mA"
          state_class: measurement
        - name: "Hassio UPS Raw Power"
          state: "{{ state_attr('sensor.hassio_ups', 'power') | round(1) }}"
          unit_of_measurement: "W"
          state_class: measurement
        - name: "Hassio UPS Raw Calculated Power"
          state: "{{ state_attr('sensor.hassio_ups', 'power_calculated') | round(1) }}"
          unit_of_measurement: "W"
          state_class: measurement
        - name: "Hassio UPS Raw Remaining Capacity"
          state: "{{ state_attr('sensor.hassio_ups', 'remaining_battery_capacity') | round(0) }}"
          unit_of_measurement: "mAh"
          state_class: measurement
        - name: "Hassio UPS Raw Remaining Time"
          state: >
            {% if is_state_attr('sensor.hassio_ups', 'remaining_time_min', '') %}
              {{ state_attr('sensor.hassio_ups', 'remaining_time_min') }}
            {% else %}
              {{ state_attr('sensor.hassio_ups', 'remaining_time_min') | float(default='0') | round | int }}
            {% endif %}
          unit_of_measurement: "min"
        - name: "Hassio UPS Raw Load Voltage"
          state: "{{ state_attr('sensor.hassio_ups', 'load_voltage') | round(2) }}"
          unit_of_measurement: "V"

    - binary_sensor:
        - name: "Hassio UPS Online"
          state: "{{ state_attr('sensor.hassio_ups', 'online') }}"
          device_class: plug

